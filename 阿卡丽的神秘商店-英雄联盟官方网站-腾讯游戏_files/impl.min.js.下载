navigator.sayswho=function(){var b=navigator.userAgent,a,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(c[1])){a=/\brv[ :]+(\d+)/g.exec(b)||[];return"IE "+(a[1]||"")}if(c[1]==="Chrome"){a=b.match(/\b(OPR|Edge)\/(\d+)/);if(a!=null){return a.slice(1).join(" ").replace("OPR","Opera")}}c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];if((a=b.match(/version\/(\d+)/i))!=null){c.splice(1,1,a[1])}return c.join(" ")};navigator.isMobile=function(w,z){var m=this.os={},x=this.browser={},b=w.match(/Web[kK]it[\/]{0,1}([\d.]+)/),y=w.match(/(Android);?[\s\/]+([\d.]+)?/),A=!!w.match(/\(Macintosh\; Intel /),q=w.match(/(iPad).*OS\s([\d_]+)/),k=w.match(/(iPod)(.*OS\s([\d_]+))?/),f=!q&&w.match(/(iPhone\sOS)\s([\d_]+)/),a=w.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),j=/Win\d{2}|Windows/.test(z),d=w.match(/Windows Phone ([\d.]+)/),s=a&&w.match(/TouchPad/),h=w.match(/Kindle\/([\d.]+)/),v=w.match(/Silk\/([\d._]+)/),r=w.match(/(BlackBerry).*Version\/([\d.]+)/),o=w.match(/(BB10).*Version\/([\d.]+)/),c=w.match(/(RIM\sTablet\sOS)\s([\d.]+)/),p=w.match(/PlayBook/),u=w.match(/Chrome\/([\d.]+)/)||w.match(/CriOS\/([\d.]+)/),l=w.match(/Firefox\/([\d.]+)/),g=w.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),t=w.match(/MSIE\s([\d.]+)/)||w.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),e=!u&&w.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),n=e||w.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);if(x.webkit=!!b){x.version=b[1]}if(y){m.android=true,m.version=y[2]}if(f&&!k){m.ios=m.iphone=true,m.version=f[2].replace(/_/g,".")}if(q){m.ios=m.ipad=true,m.version=q[2].replace(/_/g,".")}if(k){m.ios=m.ipod=true,m.version=k[3]?k[3].replace(/_/g,"."):null}if(d){m.wp=true,m.version=d[1]}if(a){m.webos=true,m.version=a[2]}if(s){m.touchpad=true}if(r){m.blackberry=true,m.version=r[2]}if(o){m.bb10=true,m.version=o[2]}if(c){m.rimtabletos=true,m.version=c[2]}if(p){x.playbook=true}if(h){m.kindle=true,m.version=h[1]}if(v){x.silk=true,x.version=v[1]}if(!v&&m.android&&w.match(/Kindle Fire/)){x.silk=true}if(u){x.chrome=true,x.version=u[1]}if(l){x.firefox=true,x.version=l[1]}if(g){m.firefoxos=true,m.version=g[1]}if(t){x.ie=true,x.version=t[1]}if(n&&(A||m.ios||j)){x.safari=true;if(!m.ios){x.version=n[1]}}if(e){x.webview=true}m.tablet=!!(q||p||(y&&!w.match(/Mobile/))||(l&&w.match(/Tablet/))||(t&&!w.match(/Phone/)&&w.match(/Touch/)));m.phone=!!(!m.tablet&&!m.ipod&&(y||f||a||r||o||(u&&w.match(/Android/))||(u&&w.match(/CriOS\/([\d.]+)/))||(l&&w.match(/Mobile/))||(t&&w.match(/Touch/))));return m.phone};navigator.is_navigator_support_websocket=function(){var a=navigator.sayswho().split(" ");switch(a[0].toLowerCase()){case"opera":return a[1]>=12;case"chrome":return a[1]>=16;case"safari":return a[1]>=7;case"firefox":return a[1]>=11;case"msie":case"ie":return a[1]>=10;default:return true}};navigator.is_navigator_support_typedarrays=function(){var a=navigator.sayswho().split(" ");switch(a[0].toLowerCase()){case"opera":return a[1]>=12;case"chrome":return a[1]>=7;case"safari":return a[1]>=6;case"firefox":return a[1]>=4;case"msie":case"ie":return a[1]>10;default:return true}};navigator.init=function(){navigator.check=navigator.is_navigator_support_websocket()?"1":"0";navigator.check+=navigator.is_navigator_support_typedarrays()?"1":"0"};var CONNECT=16;var CONNACK=32;var PUBLISH=48;var PUBACK=64;var PUBREC=80;var PUBREL=96;var PUBCOMP=112;var SUBSCRIBE=128;var SUBACK=144;var UNSUBSCRIBE=160;var UNSUBACK=176;var PINGREQ=192;var PINGRESP=208;var DISCONNECT=224;function AB2S(c){var e="";var b=new Uint8Array(c);var a=b.byteLength;for(var d=0;d<a;d++){e+=String.fromCharCode(b[d])}return e}function Mosquitto(){this.ws=null;this.onconnect=null;this.ondisconnect=null;this.onmessage=null;this.onping=null}Mosquitto.prototype={mqtt_ping:function(){if(navigator.check=="11"){var c=new ArrayBuffer(2);var b=new Int8Array(c);b[0]=PINGREQ;b[1]=0;if(this.ws.readyState==1){this.ws.send(c)}else{this.queue(c)}}else{var a=[];a.push('{"b":8,"v":192,"t":"d"}');a.push('{"b":8,"v":0,"t":"d"}');var d="["+a.join(",")+"]";this.ws.send(d)}setTimeout(function(){this.mosq.mqtt_ping()},30000)},connect:function(e,d,g,f,c,b,a){this.url=e;this.st=d;this.ch=g;this.uin=f;this.ouin=c;this.skey=b;this.ourl=a;this.mid=1;this.out_queue=new Array();this.ws=new WebSocket(e,"mqttv3.1");this.ws.binaryType="arraybuffer";this.ws.onopen=this.ws_onopen;this.ws.onclose=this.ws_onclose;if(navigator.check=="11"){this.ws.onmessage=this.ws_onmessage1}else{this.ws.onmessage=this.ws_onmessage}this.ws.m=this;this.ws.onerror=function(h){}},disconnect:function(){if(this.ws.readyState==1){if(navigator.check=="11"){var c=new ArrayBuffer(2);var b=new Int8Array(c);b[0]=DISCONNECT;b[1]=0;this.ws.send(c);this.ws.close()}else{var a=[];a.push('{"b":8,"v":224,"t":"d"}');var d="["+a.join(",")+"]";this.ws.send(d);this.ws.close()}}},ws_onopen:function(k){var g="";var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var a=0;a<8;a++){g+=f.charAt(Math.floor(Math.random()*f.length))}var h=this.m.st+":"+this.m.ch+":"+this.m.uin+":"+g+":"+this.m.ouin+":"+this.m.skey+":"+this.m.ourl;if(navigator.check=="11"){var b=new ArrayBuffer(1+1+12+2+h.length);var e=new Int8Array(b);i=0;e[i++]=CONNECT;e[i++]=12+2+h.length;e[i++]=0;e[i++]=6;str="MQIsdp";for(var a=0;a<str.length;a++){e[i++]=str.charCodeAt(a)}e[i++]=3;e[i++]=2;e[i++]=0;e[i++]=60;e[i++]=0;e[i++]=h.length;for(var a=0;a<h.length;a++){e[i++]=h.charCodeAt(a)}this.send(b);while(this.m.out_queue.length>0){this.send(this.m.out_queue.pop())}setTimeout(function(){this.mosq.mqtt_ping()},30000)}else{var d=[];d.push('{"b":8,"v":16, "t":"d"}');d.push('{"b":8,"v":'+(14+h.length)+',"t":"d"}');d.push('{"b":8,"v":0, "t":"d"}');d.push('{"b":8,"v":6, "t":"d"}');d.push('{"b":48,"v":"MQIsdp", "t":"t"}');d.push('{"b":8,"v":3, "t":"d"}');d.push('{"b":8,"v":2, "t":"d"}');d.push('{"b":8,"v":0, "t":"d"}');d.push('{"b":8,"v":255,"t":"d"}');d.push('{"b":8,"v":0,"t":"d"}');d.push('{"b":8,"v":'+h.length+',"t":"d"}');d.push('{"b":'+h.length*8+',"v":"'+h+'","t":"t"}');var c="["+d.join(",")+"]";this.send(c);setTimeout(function(){this.mosq.mqtt_ping()},30000)}},ws_onclose:function(a){if(this.m.ondisconnect){this.m.ondisconnect(a.data)}},ws_onmessage:function(a){var b=JSON.parse(a.data);for(var d=0;d<b.length;d++){var c=b[d];switch(c.cmd){case CONNACK:if(this.m.onconnect){this.m.onconnect(0)}break;case PUBLISH:if(this.m.onmessage){this.m.onmessage(c.topic,c.payload,0,0)}break;case PUBREC:case PUBREL:case PUBACK:case PUBCOMP:case SUBACK:case UNSUBACK:break;case PINGRESP:if(this.m.onping){this.m.onping()}break}}},ws_onmessage1:function(r){var k=new Int8Array(r.data);buffer=r.data;var b=0;while(k.length>0&&b<1000){b++;switch(k[0]&240){case CONNACK:var l=k[1];var a=k[2];if(this.m.onconnect){this.m.onconnect(a)}buffer=buffer.slice(l+2);k=new Int8Array(buffer);break;case PUBLISH:var f=1;var e=1;var l=0;var j=0;var n;var s=(k[0]&6)>>1;var m=(k[0]&1);var p=0;do{j++;n=k[f++];l+=(n&127)*e;e*=128}while((n&128)!=0);var d=k[f++]*256+k[f++];var c=buffer.slice(f,f+d);f+=d;var h=AB2S(c);if(s>0){p=k[f++]*256+k[f++]}var g=buffer.slice(f,l+j+1);var o=AB2S(g);buffer=buffer.slice(l+1+j);k=new Int8Array(buffer);if(this.m.onmessage){this.m.onmessage(h,o,s,m)}break;case PUBREC:case PUBREL:case PUBACK:case PUBCOMP:case SUBACK:case UNSUBACK:var l=k[1];buffer=buffer.slice(l+2);k=new Int8Array(buffer);break;case PINGRESP:var l=k[1];buffer=buffer.slice(l+2);k=new Int8Array(buffer);if(this.m.onping){this.m.onping()}break}}},get_remaining_count:function(a){if(a>=0&&a<128){return 1}else{if(a>=128&&a<16384){return 2}else{if(a>=16384&&a<2097152){return 3}else{if(a>=2097152&&a<268435456){return 4}else{return -1}}}}},generate_mid:function(){var a=this.mid;this.mid++;if(this.mid==256){this.mid=0}return a},queue:function(a){this.out_queue.push(a)},send_cmd_with_mid:function(d,c){var b=new ArrayBuffer(4);var a=new Int8Array(b);a[0]=d;a[1]=2;a[2]=c%128;a[3]=c/128;if(this.ws.readyState==1){this.ws.send(b)}else{this.queue(b)}},unsubscribe:function(d){var g=2+2+d.length;var f=this.get_remaining_count(g);var b=new ArrayBuffer(1+f+g);var a=new Int8Array(b);var e=0;a[e++]=UNSUBSCRIBE|2;do{digit=Math.floor(g%128);g=Math.floor(g/128);if(g>0){digit=digit|128}a[e++]=digit}while(g>0);a[e++]=0;a[e++]=this.generate_mid();a[e++]=0;a[e++]=d.length;for(var c=0;c<d.length;c++){a[e++]=d.charCodeAt(c)}if(this.ws.readyState==1){this.ws.send(b)}else{this.queue(b)}},subscribe:function(f,l){if(navigator.check=="11"){if(l!=0){return 1}var h=2+2+f.length+1;var k=this.get_remaining_count(h);var b=new ArrayBuffer(1+k+h);var g=new Int8Array(b);var d=0;g[d++]=SUBSCRIBE|2;do{digit=Math.floor(h%128);h=Math.floor(h/128);if(h>0){digit=digit|128}g[d++]=digit}while(h>0);g[d++]=0;g[d++]=this.generate_mid();g[d++]=0;g[d++]=f.length;for(var a=0;a<f.length;a++){g[d++]=f.charCodeAt(a)}g[d++]=l;if(this.ws.readyState==1){this.ws.send(b)}else{this.queue(b)}}else{var e=[];e.push('{"b":8,"v":130,"t":"d"}');e.push('{"b":8,"v":'+(5+f.length)+',"t":"d"}');e.push('{"b":8,"v":0,"t":"d"}');e.push('{"b":8,"v":'+this.generate_mid()+',"t":"d"}');e.push('{"b":8,"v":0,"t":"d"}');e.push('{"b":8,"v":'+f.length+',"t":"d"}');e.push('{"b":'+8*f.length+',"v":"'+f+'","t":"t"}');e.push('{"b":8,"v":'+l+',"t":"d"}');var c="["+e.join(",")+"]";this.ws.send(c)}},publish:function(f,m,n,k){if(navigator.check=="11"){if(n!=0){return 1}var h=2+f.length+m.length;var l=this.get_remaining_count(h);var b=new ArrayBuffer(1+l+h);var g=new Int8Array(b);var d=0;k=k?1:0;g[d++]=PUBLISH|(n<<1)|k;do{digit=Math.floor(h%128);h=Math.floor(h/128);if(h>0){digit=digit|128}g[d++]=digit}while(h>0);g[d++]=0;g[d++]=f.length;for(var a=0;a<f.length;a++){g[d++]=f.charCodeAt(a)}for(var a=0;a<m.length;a++){g[d++]=m.charCodeAt(a)}if(this.ws.readyState==1){this.ws.send(b)}else{this.queue(b)}}else{var e=[];e.push('{"b":8,"v":'+(PUBLISH|(n<<1)|k)+',"t":"d"}');e.push('{"b":8,"v":'+(2+f.length+m.length)+',"t":"d"}');e.push('{"b":8,"v":0,"t":"d"}');e.push('{"b":8,"v":'+f.length+',"t":"d"}');e.push('{"b":'+8*f.length+',"v":"'+f+'","t":"t"}');e.push('{"b":'+8*m.length+',"v":"'+m+'","t":"t"}');var c="["+e.join(",")+"]";this.ws.send(c)}}};var rt_push_impl={init:function(){navigator.init();if(navigator.isMobile(navigator.userAgent,navigator.platform)){navigator.check="11"}if(navigator.check!="11"){window.WebSocket={}}else{if(window.MozWebSocket){window.WebSocket=MozWebSocket}return}if(swfobject.getFlashPlayerVersion().major<10){logger.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){logger.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...")}window.WebSocket=function(c,d,b,f,e){var a=this;a.__id=WebSocket.__nextId++;WebSocket.__instances[a.__id]=a;a.readyState=WebSocket.CONNECTING;a.bufferedAmount=0;a.__events={};if(!d){d=[]}else{if(typeof d=="string"){d=[d]}}a.__createTask=setTimeout(function(){WebSocket.__addTask(function(){a.__createTask=null;WebSocket.__flash.create(a.__id,c,d,b||null,f||0,e||null)})},0)};WebSocket.prototype.send=function(b){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var a=WebSocket.__flash.send(this.__id,encodeURIComponent(b));if(a<0){return true}else{this.bufferedAmount+=a;return false}};WebSocket.prototype.close=function(){if(this.__createTask){clearTimeout(this.__createTask);this.__createTask=null;this.readyState=WebSocket.CLOSED;return}if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(b,c,a){if(!(b in this.__events)){this.__events[b]=[]}this.__events[b].push(c)};WebSocket.prototype.removeEventListener=function(d,e,a){if(!(d in this.__events)){return}var c=this.__events[d];for(var b=c.length-1;b>=0;--b){if(c[b]===e){c.splice(b,1);break}}};WebSocket.prototype.dispatchEvent=function(d){var b=this.__events[d.type]||[];for(var a=0;a<b.length;++a){b[a](d)}var c=this["on"+d.type];if(c){c.apply(this,[d])}};WebSocket.prototype.__handleEvent=function(c){if("readyState" in c){this.readyState=c.readyState}if("protocol" in c){this.protocol=c.protocol}var a;if(c.type=="open"||c.type=="error"){a=this.__createSimpleEvent(c.type)}else{if(c.type=="close"){a=this.__createSimpleEvent("close");a.wasClean=c.wasClean?true:false;a.code=c.code;a.reason=c.reason}else{if(c.type=="message"){var b=decodeURIComponent(c.message);a=this.__createMessageEvent("message",b)}else{throw"unknown event type: "+c.type}}}this.dispatchEvent(a)};WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,false,false);return b}else{return{type:a,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(a,c){if(window.MessageEvent&&typeof(MessageEvent)=="function"&&!window.opera){return new MessageEvent("message",{view:window,bubbles:false,cancelable:false,data:c})}else{if(document.createEvent&&window.MessageEvent&&!window.opera){var b=document.createEvent("MessageEvent");b.initMessageEvent("message",false,false,c,null,null,window,null);return b}else{return{type:a,data:c,bubbles:false,cancelable:false}}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__isFlashImplementation=true;WebSocket.__initialized=false;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})};WebSocket.__initialize=function(){if(WebSocket.__initialized){return}WebSocket.__initialized=true;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){logger.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var c=RegExp.$1;if(location.host!=c){logger.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+c+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}}var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";if(WebSocket.__isFlashLite()){a.style.left="0px";a.style.top="0px"}else{a.style.left="-100px";a.style.top="-100px"}var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(d){if(!d.success){logger.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a){WebSocket.__tasks[a]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var b=WebSocket.__flash.receiveEvents();for(var a=0;a<b.length;++a){WebSocket.__instances[b[a].webSocketId].__handleEvent(b[a])}}catch(c){logger.error(c)}},0);return true};WebSocket.__log=function(a){logger.log(decodeURIComponent(a))};WebSocket.__error=function(a){logger.error(decodeURIComponent(a))};WebSocket.__addTask=function(a){if(WebSocket.__flash){a()}else{WebSocket.__tasks.push(a)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var a=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!a||!a.enabledPlugin||!a.enabledPlugin.filename){return false}return a.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})}}};